import{j as e}from"./jsx-runtime.EKYJJIwR.js";import{r as m}from"./index.DrxKNVES.js";import{u as T,F,a as v,b as C,d as D}from"./form.93GIvI3c.js";import{B as b}from"./button.x7-QiqwQ.js";import{C as z,a as E}from"./card.BAnZFR_a.js";import{D as A,a as R,b as $,c as O,d as M,e as P,f as V}from"./dialog.C0ZfxG5a.js";import{S as U,a as q,b as B,c as H,d as W}from"./select.BKrJ3BO-.js";import{i as S}from"./is-defined.BPY7jSh6.js";import{u as X}from"./use-toast.BikYzejn.js";import{a as y,h as N,b as k}from"./toast-handler.Ct0WAJ7j.js";import{X as G}from"./x.DYFGPTRN.js";import{P as I}from"./plus.CAt6JUe3.js";import"./index.BLEmuFXE.js";import"./index.1JkRN11X.js";import"./index.2EOGNVNh.js";import"./index.rqUiOy30.js";import"./index.B2LyIUNT.js";import"./index.Li38iYKq.js";import"./classnames.B8F8Dq1p.js";import"./index.BZXvyPAu.js";import"./index.BJknnQuW.js";import"./index.qJiwp9Ip.js";import"./index.BRpELbpY.js";import"./index.yusZEH1f.js";import"./Combination.CoL-rreF.js";import"./index.CdA-AeYO.js";import"./index.CwYy1fy-.js";import"./index.CoUN5iVw.js";import"./index.Ca4aSXhd.js";import"./index.CGPvhYpy.js";import"./index.wLl3Idx7.js";import"./chevrons-up-down.BMPs55cN.js";import"./createLucideIcon.D2R2PR3o.js";import"./chevron-down.DmgAbkcx.js";import"./env.Bik-fSFe.js";import"./dev-console-log.CInb5xbI.js";import"./index.CdM0oSJi.js";import"./message-display.CI2NEmxy.js";async function J(i){try{const{idFrom:o,idTo:l}=i,{data:s}=await y.post(`/api/project/id/${o}/stack/${l}`);return s}catch(o){throw N({error:o,defaultErrorMessage:"No se pudo agregar el stack al proyecto."})}}async function K(i){try{const{idFrom:o,idTo:l}=i,{data:s}=await y.delete(`/api/project/id/${o}/stack/${l}`);return s}catch(o){throw N({error:o,defaultErrorMessage:"No se pudo eliminar el stack del proyecto."})}}function Re({currentProject:i,associatedStacks:o,availableStacks:l,disableForm:s}){const{toast:p}=X(),[w,n]=m.useState(!1),c=T({defaultValues:{idFrom:i.id}}),[x,u]=m.useState(o),[h,g]=m.useState(l),f=async a=>{try{await J({idFrom:Number(a.idFrom),idTo:Number(a.idTo)}),c.reset(),p({title:"Stack relacionado con el proyecto",description:"El stack ha sido relacionado con el proyecto exitosamente.",className:"bg-green-500 text-black"});const r=h.find(t=>t.id===Number(a.idTo));S(r)&&(u(t=>[...t,r]),g(t=>t.filter(d=>d.id!==Number(a.idTo)))),n(!1)}catch(r){k({error:r,title:"No se pudo relacionar el stack",defaultErrorMessage:"Ocurrió un error al intentar relacionar el stack con el proyecto.",tryAgain:()=>f(a)})}},j=async a=>{try{await K({idFrom:i.id,idTo:a}),p({title:"Stack eliminado",description:"El stack ha sido eliminado del proyecto exitosamente.",className:"bg-green-500 text-black"});const r=x.find(t=>t.id===a);S(r)&&(g(t=>[...t,r]),u(t=>t.filter(d=>d.id!==a))),n(!1)}catch(r){k({error:r,title:"No se pudo eliminar el stack",defaultErrorMessage:"Ocurrió un error al intentar eliminar el stack del proyecto.",tryAgain:()=>j(a)})}};return e.jsxs("ul",{className:"mt-4 flex flex-wrap gap-4",children:[x?.map(a=>e.jsx("li",{children:e.jsx(z,{className:"my-5 flex w-max flex-col items-center justify-center rounded-lg bg-zinc-300 shadow dark:bg-zinc-800",children:e.jsxs(E,{className:"relative",children:[e.jsxs(b,{"aria-label":"eliminar relacion",className:"absolute -right-2.5 -top-2.5 m-0 flex aspect-square size-8 items-center justify-center rounded-full bg-red-500 p-0 text-center text-white hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-500",disabled:s,onClick:()=>j(a.id),children:[e.jsx(G,{}),e.jsx("span",{className:"sr-only",children:"eliminar relacion"})]}),e.jsx("img",{alt:`${a.name} logo`,className:"size-20 rounded-lg",src:a.iconUrl})]})})},a.id)),e.jsx("li",{children:e.jsxs(A,{open:w,onOpenChange:n,children:[e.jsx(R,{asChild:!0,children:e.jsx("button",{"aria-label":"Relacionar stack",className:"my-5 flex aspect-square w-max flex-col items-center justify-center rounded-lg bg-zinc-300 p-6 shadow dark:bg-zinc-800",type:"button",children:e.jsx(I,{className:"size-20"})})}),e.jsxs($,{className:"sm:max-w-[425px]",children:[e.jsxs(O,{children:[e.jsx(M,{className:"text-center",children:"Relacionar stack"}),e.jsx(P,{children:"Selecciona un stack para relacionar con el proyecto."})]}),e.jsx(F,{...c,children:e.jsx("form",{className:"space-y-8",id:"relation-with-stack",onSubmit:c.handleSubmit(f),children:e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(v,{control:c.control,name:"idTo",render:({field:a})=>e.jsx(C,{className:"mx-auto",children:e.jsx(D,{children:e.jsxs(U,{defaultValue:String(a.value),onValueChange:a.onChange,...a,value:String(a.value),children:[e.jsx(q,{className:"w-[180px]",children:e.jsx(B,{placeholder:"Seleccionar stack"})}),e.jsx(H,{children:h.map(r=>e.jsx(W,{value:String(r.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{alt:`${r.name} logo`,className:"size-6",src:r.iconUrl}),e.jsx("span",{children:r.name})]})},r.id))})]})})})})})})}),e.jsx(V,{children:e.jsx(b,{className:"bg-zinc-800 text-white hover:bg-zinc-700",disabled:s,form:"relation-with-stack",type:"submit",typeof:"submit",children:"Relacionar"})})]})]})})]})}export{Re as UpdateStacksRelatedToProject};
