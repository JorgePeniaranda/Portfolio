import{j as e}from"./jsx-runtime.EKYJJIwR.js";import{r as d}from"./index.DrxKNVES.js";import{u as P,F as T,a as F,b as v,d as C}from"./form.93GIvI3c.js";import{B as b}from"./button.x7-QiqwQ.js";import{C as D,a as z}from"./card.BAnZFR_a.js";import{D as E,a as A,b as R,c as $,d as O,e as M,f as V}from"./dialog.C0ZfxG5a.js";import{S as I,a as U,b as q,c as B,d as H}from"./select.BKrJ3BO-.js";import{i as y}from"./is-defined.BPY7jSh6.js";import{u as W}from"./use-toast.BikYzejn.js";import{a as k,h as S,b as N}from"./toast-handler.Dg2NQAfd.js";import{X}from"./x.DYFGPTRN.js";import{P as G}from"./plus.CAt6JUe3.js";import"./index.BLEmuFXE.js";import"./index.1JkRN11X.js";import"./index.2EOGNVNh.js";import"./index.rqUiOy30.js";import"./index.B2LyIUNT.js";import"./index.Li38iYKq.js";import"./classnames.B8F8Dq1p.js";import"./index.BZXvyPAu.js";import"./index.BJknnQuW.js";import"./index.qJiwp9Ip.js";import"./index.BRpELbpY.js";import"./index.yusZEH1f.js";import"./Combination.CoL-rreF.js";import"./index.CdA-AeYO.js";import"./index.CwYy1fy-.js";import"./index.CoUN5iVw.js";import"./index.Ca4aSXhd.js";import"./index.CGPvhYpy.js";import"./index.wLl3Idx7.js";import"./chevrons-up-down.BMPs55cN.js";import"./createLucideIcon.D2R2PR3o.js";import"./chevron-down.DmgAbkcx.js";import"./env.ClbHb-Tu.js";import"./dev-console-log.CInb5xbI.js";import"./index.CdM0oSJi.js";import"./message-display.CI2NEmxy.js";async function J(s){try{const{idFrom:o,idTo:l}=s,{data:i}=await k.post(`/api/stack/id/${o}/project/${l}`);return i}catch(o){throw S({error:o,defaultErrorMessage:"No se pudo agregar el proyecto al stack."})}}async function K(s){try{const{idFrom:o,idTo:l}=s,{data:i}=await k.delete(`/api/stack/id/${o}/project/${l}`);return i}catch(o){throw S({error:o,defaultErrorMessage:"No se pudo eliminar el proyecto del stack."})}}function Ae({currentStack:s,associatedProjects:o,availableProject:l,disableForm:i}){const{toast:p}=W(),[w,n]=d.useState(!1),[x,h]=d.useState(o),[u,g]=d.useState(l),c=P({defaultValues:{idFrom:s.id}}),f=async r=>{try{await J({idFrom:Number(r.idFrom),idTo:Number(r.idTo)}),c.reset(),p({title:"Proyecto relacionado con el stack",description:"El proyecto ha sido relacionado con el stack.",className:"bg-green-500 text-black"});const a=u.find(t=>t.id===Number(r.idTo));y(a)&&(h(t=>[...t,a]),g(t=>t.filter(m=>m.id!==Number(r.idTo)))),n(!1)}catch(a){N({error:a,title:"No se pudo relacionar el proyecto",defaultErrorMessage:"Ocurrió un error al intentar relacionar el proyecto con el stack.",tryAgain:()=>f(r)})}},j=async r=>{try{await K({idFrom:s.id,idTo:r}),p({title:"Proyecto eliminado",description:"El proyecto ha sido eliminado del stack.",className:"bg-green-500 text-black"});const a=x.find(t=>t.id===r);y(a)&&(g(t=>[...t,a]),h(t=>t.filter(m=>m.id!==r))),n(!1)}catch(a){N({error:a,title:"No se pudo eliminar el proyecto",defaultErrorMessage:"Ocurrió un error al intentar eliminar el proyecto del stack.",tryAgain:()=>j(r)})}};return e.jsxs("ul",{className:"mt-4 flex flex-wrap gap-4",children:[x?.map(r=>e.jsx("li",{children:e.jsx(D,{className:"my-5 flex flex-col items-center justify-center rounded-lg bg-zinc-300 shadow dark:bg-zinc-800",children:e.jsxs(z,{className:"relative flex items-center gap-2",children:[e.jsxs(b,{"aria-label":"eliminar relacion",className:"absolute -right-2.5 -top-2.5 m-0 flex aspect-square size-8 items-center justify-center rounded-full bg-red-500 p-0 text-center text-white hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-500",disabled:i,onClick:()=>j(r.id),children:[e.jsx(X,{}),e.jsx("span",{className:"sr-only",children:"eliminar relacion"})]}),e.jsx("img",{alt:`${r.name} logo`,className:"size-16 shrink-0",src:r.logoUrl}),e.jsx("span",{className:"text-lg capitalize",children:r.name})]})})},r.id)),e.jsx("li",{children:e.jsxs(E,{open:w,onOpenChange:n,children:[e.jsx(A,{asChild:!0,children:e.jsx("button",{"aria-label":"Relacionar stack",className:"my-5 flex aspect-square w-max flex-col items-center justify-center rounded-lg bg-zinc-300 p-6 shadow dark:bg-zinc-800",type:"button",children:e.jsx(G,{className:"size-20"})})}),e.jsxs(R,{className:"sm:max-w-[425px]",children:[e.jsxs($,{children:[e.jsx(O,{className:"text-center",children:"Relacionar proyecto"}),e.jsx(M,{children:"Selecciona un proyecto para relacionar con el stack."})]}),e.jsx(T,{...c,children:e.jsx("form",{className:"space-y-8",id:"relation-with-project-from-stack",onSubmit:c.handleSubmit(f),children:e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(F,{control:c.control,name:"idTo",render:({field:r})=>e.jsx(v,{className:"mx-auto",children:e.jsx(C,{children:e.jsxs(I,{defaultValue:String(r.value),onValueChange:r.onChange,...r,value:String(r.value),children:[e.jsx(U,{className:"w-[180px]",children:e.jsx(q,{placeholder:"Seleccionar proyecto"})}),e.jsx(B,{children:u.map(a=>e.jsx(H,{value:String(a.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{alt:`${a.name} logo`,className:"size-6",src:a.logoUrl}),e.jsx("span",{children:a.name})]})},a.id))})]})})})})})})}),e.jsx(V,{children:e.jsx(b,{className:"bg-zinc-800 text-white hover:bg-zinc-700",disabled:i,form:"relation-with-project-from-stack",type:"submit",typeof:"submit",children:"Relacionar"})})]})]})})]})}export{Ae as UpdateProjectsRelatedToStack};
