import{j as e}from"./jsx-runtime.EKYJJIwR.js";import{r as m}from"./index.DrxKNVES.js";import{u as S,F,a as T,b as A,d as D}from"./form.93GIvI3c.js";import{A as z,a as E,b as k}from"./avatar.D_as68jP.js";import{B as j}from"./button.x7-QiqwQ.js";import{C as R,a as $}from"./card.BAnZFR_a.js";import{D as O,a as U,b as M,c as P,d as V,e as q,f as B}from"./dialog.C0ZfxG5a.js";import{S as H,a as I,b as W,c as X,d as G}from"./select.BKrJ3BO-.js";import{i as y}from"./is-defined.BPY7jSh6.js";import{u as J}from"./use-toast.BikYzejn.js";import{a as C,h as w,b as N}from"./toast-handler.Dg2NQAfd.js";import{X as K}from"./x.DYFGPTRN.js";import{P as L}from"./plus.CAt6JUe3.js";import"./index.BLEmuFXE.js";import"./index.1JkRN11X.js";import"./index.2EOGNVNh.js";import"./index.rqUiOy30.js";import"./index.B2LyIUNT.js";import"./index.Li38iYKq.js";import"./classnames.B8F8Dq1p.js";import"./index.qJiwp9Ip.js";import"./index.BZXvyPAu.js";import"./index.BJknnQuW.js";import"./index.BRpELbpY.js";import"./index.yusZEH1f.js";import"./Combination.CoL-rreF.js";import"./index.CdA-AeYO.js";import"./index.CwYy1fy-.js";import"./index.CoUN5iVw.js";import"./index.Ca4aSXhd.js";import"./index.CGPvhYpy.js";import"./index.wLl3Idx7.js";import"./chevrons-up-down.BMPs55cN.js";import"./createLucideIcon.D2R2PR3o.js";import"./chevron-down.DmgAbkcx.js";import"./env.ClbHb-Tu.js";import"./dev-console-log.CInb5xbI.js";import"./index.CdM0oSJi.js";import"./message-display.CI2NEmxy.js";async function Q(i){try{const{idFrom:t,idTo:l}=i,{data:s}=await C.post(`/api/project/id/${t}/collaborator/${l}`);return s}catch(t){throw w({error:t,defaultErrorMessage:"No se pudo agregar el colaborador al proyecto."})}}async function Y(i){try{const{idFrom:t,idTo:l}=i,{data:s}=await C.delete(`/api/project/id/${t}/collaborator/${l}`);return s}catch(t){throw w({error:t,defaultErrorMessage:"No se pudo eliminar el colaborador del proyecto."})}}function Me({currentProject:i,associatedCollaborators:t,availableCollaborators:l,disableForm:s}){const{toast:p}=J(),[v,c]=m.useState(!1),[h,b]=m.useState(t),[u,x]=m.useState(l),n=S({defaultValues:{idFrom:i.id}}),g=async r=>{try{await Q({idFrom:Number(r.idFrom),idTo:Number(r.idTo)}),n.reset(),p({title:"El colaborador ha sido relacionado",description:"El colaborador ha sido relacionado con el proyecto exitosamente.",className:"bg-green-500 text-black"});const a=u.find(o=>o.id===Number(r.idTo));y(a)&&(b(o=>[...o,a]),x(o=>o.filter(d=>d.id!==Number(r.idTo)))),c(!1)}catch(a){N({error:a,title:"No se pudo relacionar el proyecto con el colaborador",defaultErrorMessage:"Ocurrió un error al intentar relacionar el proyecto con el colaborador.",tryAgain:()=>g(r)})}},f=async r=>{try{await Y({idFrom:i.id,idTo:r}),p({title:"Colaborador eliminado",description:"El colaborador ha sido eliminado del proyecto.",className:"bg-green-500 text-black"});const a=h.find(o=>o.id===r);y(a)&&(b(o=>o.filter(d=>d.id!==r)),x(o=>[...o,a])),c(!1)}catch(a){N({error:a,title:"No se pudo eliminar el proyecto del colaborador",defaultErrorMessage:"Ocurrió un error al intentar eliminar el proyecto con el colaborador.",tryAgain:()=>f(r)})}};return e.jsxs("ul",{className:"mt-4 flex flex-wrap gap-4",children:[h?.map(r=>e.jsx("li",{children:e.jsx(R,{className:"my-5 flex w-max flex-col items-center justify-center rounded-lg bg-zinc-300 shadow dark:bg-zinc-800",children:e.jsxs($,{className:"relative flex items-center gap-2",children:[e.jsxs(j,{"aria-label":"eliminar relacion",className:"absolute -right-2.5 -top-2.5 m-0 flex aspect-square size-8 items-center justify-center rounded-full bg-red-500 p-0 text-center text-white hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-500",disabled:s,onClick:()=>f(r.id),children:[e.jsx(K,{}),e.jsx("span",{className:"sr-only",children:"eliminar relacion"})]}),e.jsxs(z,{className:"size-16 shrink-0",children:[e.jsx(E,{src:`https://avatars.githubusercontent.com/${r.githubUsername}`}),e.jsx(k,{children:r.githubUsername})]}),e.jsx("span",{className:"text-lg capitalize",children:r.githubUsername})]})})},r.id)),e.jsx("li",{children:e.jsxs(O,{open:v,onOpenChange:c,children:[e.jsx(U,{asChild:!0,children:e.jsx("button",{"aria-label":"Relacionar colaborador",className:"my-5 flex aspect-square w-max flex-col items-center justify-center rounded-lg bg-zinc-300 p-6 shadow dark:bg-zinc-800",type:"button",children:e.jsx(L,{className:"size-20"})})}),e.jsxs(M,{className:"sm:max-w-[425px]",children:[e.jsxs(P,{children:[e.jsx(V,{className:"text-center",children:"Relacionar colaborador"}),e.jsx(q,{children:"Selecciona un colaborador para relacionar con el proyecto."})]}),e.jsx(F,{...n,children:e.jsx("form",{className:"space-y-8",id:"relation-with-collaborator",onSubmit:n.handleSubmit(g),children:e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(T,{control:n.control,name:"idTo",render:({field:r})=>e.jsx(A,{className:"mx-auto",children:e.jsx(D,{children:e.jsxs(H,{defaultValue:String(r.value),onValueChange:r.onChange,...r,value:String(r.value),children:[e.jsx(I,{className:"w-[180px]",children:e.jsx(W,{placeholder:"Seleccionar colaborador"})}),e.jsx(X,{children:u.map(a=>e.jsx(G,{value:String(a.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{alt:`${a.nickname} logo`,className:"size-6",src:`https://avatars.githubusercontent.com/${a.githubUsername}`}),e.jsx("span",{children:a.nickname})]})},a.id))})]})})})})})})}),e.jsx(B,{children:e.jsx(j,{className:"bg-zinc-800 text-white hover:bg-zinc-700",disabled:s,form:"relation-with-collaborator",type:"submit",typeof:"submit",children:"Relacionar"})})]})]})})]})}export{Me as UpdateCollaboratorRelatedToProject};
